<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#333333">
    <title>Kids Drawing App</title>
    <link rel="manifest" id="manifest">
    <script>
        const manifest = {
            "name": "Kids Drawing App",
            "short_name": "Draw",
            "display": "standalone",
            "orientation": "any",
            "start_url": window.location.href,
            "scope": "/",
            "background_color": "#f0f0f0",
            "theme_color": "#333333",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect fill='%23333' width='512' height='512'/%3E%3Cpath fill='%23fff' d='M256 80l-40 120h-120l96 72-36 128 100-76 100 76-36-128 96-72h-120z'/%3E%3C/svg%3E",
                    "sizes": "512x512",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                }
            ]
        };
        const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest').setAttribute('href', manifestURL);
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            overflow: hidden;
            background: #f0f0f0;
        }

        #container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        #canvas {
            flex: 1;
            background: white;
            cursor: crosshair;
            touch-action: none;
        }

        #toolbar {
            background: #333;
            padding: 15px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .toolbar-left {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            flex: 1;
            justify-content: center;
        }

        .color-palette {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-btn {
            width: 45px;
            height: 45px;
            border: 3px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .color-btn:hover {
            transform: scale(1.1);
        }

        .color-btn.active {
            border-color: #ffeb3b;
            border-width: 4px;
            transform: scale(1.15);
        }

        .divider {
            width: 2px;
            height: 50px;
            background: #666;
        }

        .brush-sizes {
            display: flex;
            gap: 10px;
        }

        .brush-btn {
            width: 50px;
            height: 50px;
            background: white;
            border: 3px solid #666;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .brush-btn:hover {
            transform: scale(1.1);
            border-color: #ffeb3b;
        }

        .brush-btn.active {
            border-color: #ffeb3b;
            border-width: 4px;
            background: #fffde7;
        }

        .brush-btn .dot {
            background: #333;
            border-radius: 50%;
        }

        .brush-btn.small .dot {
            width: 8px;
            height: 8px;
        }

        .brush-btn.medium .dot {
            width: 16px;
            height: 16px;
        }

        .brush-btn.large .dot {
            width: 28px;
            height: 28px;
        }

        .tool-btn {
            padding: 12px 24px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
        }

        .eraser-btn {
            background: #e91e63;
        }

        .eraser-btn:hover {
            background: #c2185b;
            transform: scale(1.05);
        }

        .eraser-btn.active {
            background: #880e4f;
            box-shadow: 0 0 0 4px #ffeb3b;
        }

        .clear-btn {
            background: #f44336;
            position: relative;
            overflow: hidden;
        }

        .clear-btn:hover {
            background: #d32f2f;
            transform: scale(1.05);
        }

        .clear-btn .progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 100%;
            background: #880e4f;
            width: 0%;
            transition: none;
        }

        .clear-btn span {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .trash-icon {
            width: 24px;
            height: 24px;
            stroke: white;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        @media (max-width: 768px) {
            #toolbar {
                padding: 10px;
                gap: 10px;
            }

            .color-btn {
                width: 38px;
                height: 38px;
            }

            .brush-btn {
                width: 45px;
                height: 45px;
            }

            .tool-btn {
                padding: 10px 18px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="canvas"></canvas>
        <div id="toolbar">
            <div class="toolbar-left">
                <div class="color-palette">
                    <div class="color-btn active" style="background: #000000;" data-color="#000000"></div>
                    <div class="color-btn" style="background: #ff0000;" data-color="#ff0000"></div>
                    <div class="color-btn" style="background: #ff6600;" data-color="#ff6600"></div>
                    <div class="color-btn" style="background: #ffff00;" data-color="#ffff00"></div>
                    <div class="color-btn" style="background: #00ff00;" data-color="#00ff00"></div>
                    <div class="color-btn" style="background: #0099ff;" data-color="#0099ff"></div>
                    <div class="color-btn" style="background: #6600ff;" data-color="#6600ff"></div>
                    <div class="color-btn" style="background: #ff00ff;" data-color="#ff00ff"></div>
                    <div class="color-btn" style="background: #8b4513;" data-color="#8b4513"></div>
                    <div class="color-btn" style="background: #ffffff; border-color: #999;" data-color="#ffffff"></div>
                    <div class="color-btn" style="background: #808080;" data-color="#808080"></div>
                    <div class="color-btn" style="background: #ffc0cb;" data-color="#ffc0cb"></div>
                </div>
                
                <div class="divider"></div>
                
                <div class="brush-sizes">
                    <button class="brush-btn small" data-size="5">
                        <div class="dot"></div>
                    </button>
                    <button class="brush-btn medium active" data-size="15">
                        <div class="dot"></div>
                    </button>
                    <button class="brush-btn large" data-size="30">
                        <div class="dot"></div>
                    </button>
                </div>
                
                <div class="divider"></div>
                
                <button class="tool-btn eraser-btn" id="eraserBtn">Eraser</button>
            </div>
            
            <button class="tool-btn clear-btn" id="clearBtn">
                <div class="progress"></div>
                <span>
                    <svg class="trash-icon" viewBox="0 0 24 24">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </span>
            </button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let isDrawing = false;
        let currentColor = '#000000';
        let currentSize = 15;
        let isEraser = false;

        function resizeCanvas() {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            
            // Only copy if canvas has content
            if (canvas.width > 0 && canvas.height > 0) {
                tempCtx.drawImage(canvas, 0, 0);
            }
            
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // Only restore if there was content
            if (tempCanvas.width > 0 && tempCanvas.height > 0) {
                ctx.drawImage(tempCanvas, 0, 0);
            }
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        function startDrawing(e) {
            isDrawing = true;
            draw(e);
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.beginPath();
        }

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches ? e.touches[0] : e;
            return {
                x: touch.clientX - rect.left,
                y: touch.clientY - rect.top
            };
        }

        function draw(e) {
            if (!isDrawing) return;
            
            e.preventDefault();
            const pos = getPos(e);
            
            ctx.lineWidth = currentSize;
            ctx.lineCap = 'round';
            ctx.strokeStyle = isEraser ? '#ffffff' : currentColor;
            
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);

        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentColor = btn.dataset.color;
                isEraser = false;
                document.getElementById('eraserBtn').classList.remove('active');
            });
        });

        document.querySelectorAll('.brush-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.brush-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentSize = parseInt(btn.dataset.size);
            });
        });

        document.getElementById('eraserBtn').addEventListener('click', () => {
            isEraser = !isEraser;
            document.getElementById('eraserBtn').classList.toggle('active');
            if (isEraser) {
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
            }
        });

        let clearTimer = null;
        let clearProgress = null;
        const clearBtn = document.getElementById('clearBtn');
        const progressBar = clearBtn.querySelector('.progress');

        function startClearTimer(e) {
            e.preventDefault();
            const startTime = Date.now();
            
            clearTimer = setTimeout(() => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                progressBar.style.width = '0%';
                progressBar.style.transition = 'none';
            }, 3000);
            
            clearProgress = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min((elapsed / 3000) * 100, 100);
                progressBar.style.width = progress + '%';
            }, 16);
        }

        function cancelClearTimer() {
            if (clearTimer) {
                clearTimeout(clearTimer);
                clearTimer = null;
            }
            if (clearProgress) {
                clearInterval(clearProgress);
                clearProgress = null;
            }
            setTimeout(() => {
                progressBar.style.transition = 'width 0.3s ease';
                progressBar.style.width = '0%';
            }, 50);
        }

        clearBtn.addEventListener('mousedown', startClearTimer);
        clearBtn.addEventListener('mouseup', cancelClearTimer);
        clearBtn.addEventListener('mouseleave', cancelClearTimer);
        clearBtn.addEventListener('touchstart', startClearTimer);
        clearBtn.addEventListener('touchend', cancelClearTimer);
        clearBtn.addEventListener('touchcancel', cancelClearTimer);
    </script>
</body>
</html>